!function(t){"use strict";var e=function(s,n){s||e.error("Missing selector.");for(var o=0;o<i.length;o++)i[o]===s&&e.error("An instance of Rider with this selector already exists.");i.push(s),this.options=e.extend({blockClass:"rider",itemClass:"rider__item",visibleCount:1,page:1,reverseHideDirection:!1},n||{}),this.events={},this.element=s,this.items=e.$("."+this.options.itemClass,s),this.items.forEach(function(t,e){t.setAttribute("data-rider-index",e.toString())}),this.itemClassTemplate=e.format("{0}--{status} {0}--{status}--{index} {0}--{status}--{direction} {0}--{status}--{direction}--{index}",this.options.itemClass),this.itemClassRemovePattern=new RegExp(e.format("{0}--(show|hide)(--)?(next|prev|init)?(--)?(\\d+)?",this.options.itemClass),"g"),this.elementClassTemplate=e.format("{0}--page-count--{total} {0}--current-page--{current} {0}--visible-count--{visible}",this.options.blockClass),this.elementClassRemovePattern=new RegExp(e.format("{0}--(page-count|current-page|visible-count)(--\\d+)?",this.options.blockClass),"g"),this.sliding=null,this.animationEndEvent=e.getAnimationEndEvent(),this.render(null,null,"init"),e.on(t,"RiderResize",this.resize.bind(this)),e.on(this.element,this.animationEndEvent,this.animationEnd.bind(this))};e.error=function(t){throw new Error(t)},e.on=function(t,e,i){t&&t.addEventListener(e,i,!1)},e.off=function(t,e,i){t&&t.removeEventListener(e,i,!1)},e.addClass=function(t,e){t&&(t.className=(t.className+" "+e).trim())},e.removeClass=function(t,e){t&&(t.className=t.className.replace(e,"").replace(/\s\s+/g," ").trim())},e.hasClass=function(t,e){if(t)return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},e.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},e.isFunction=function(t){return t&&"[object Function]"===Object.prototype.toString.call(t)},e.template=function(t,e){if("string"==typeof t){var i=t;if(this.isObject(e))for(var s in e){var n=e[s];i=i.split("{"+s+"}").join(null===n?"":n)}else{var o=Array.prototype.slice.call(arguments,1);i=i.replace(/{(\d+)}/g,function(t,e){return"undefined"!=typeof o[e]?o[e]:t})}return i}return t(e)},e.format=function(){return e.template.apply(e,arguments)},e.extend=function(t,e){var i,s={};for(i in t)s[i]=t[i];for(i in e)s[i]=e[i];return s},e.$=function(t,e){return Array.prototype.slice.call((e||document).querySelectorAll(t))},e.arrayDiff=function(t,e){return t.filter(function(t){return e.indexOf(t)<0})},e.getAnimationEndEvent=function(){var t,e=document.createElement("rider"),i={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in i)if(void 0!==e.style[t])return i[t]},e.throttle=function(t,i,s){s=s||window;var n=!1,o=function(){n||(n=!0,requestAnimationFrame(function(){s.dispatchEvent(new CustomEvent(i)),n=!1}))};e.on(s,t,o)},e.throttle("resize","RiderResize");var i=[];e.prototype={resize:function(t){this.render()},render:function(t,i,s){var n=this;this.calculateValues(),s=s||"next",i=i||this.visibleItems,t?this.hide(t,s):this.reset(),i&&this.show(i,s),this.calculateValues(),e.removeClass(this.element,this.elementClassRemovePattern),e.addClass(this.element,e.format(this.elementClassTemplate,{total:this.pageCount,current:this.currentPage,visible:this.visibleCount})),setTimeout(function(){n.onRender()},0)},runCallback:function(t){var i="on"+t.charAt(0).toUpperCase()+t.slice(1);e.isFunction(this.options[i])&&this.options[i].call(this),this.element.dispatchEvent(this.getCustomEvent(t))},on:function(t,i){e.on(this.element,t,i)},off:function(t,i){e.on(this.element,t,i)},setCustomEvent:function(t){var e=this;this.events[t]=new CustomEvent(t,{detail:{rider:e},bubbles:!0,cancelable:!0})},getCustomEvent:function(t){return t in this.events?this.events[t].detail.rider=this:this.setCustomEvent(t),this.events[t]},show:function(t,e){this.update(t,"show",e)},hide:function(t,e){this.reset(),e&&this.options.reverseHideDirection&&(e="prev"===e?"next":"prev"),this.update(t,"hide",e)},reset:function(){var t=this;this.items.forEach(function(i){e.removeClass(i,t.itemClassRemovePattern)})},update:function(t,i,s){var n=this;t.forEach(function(t,o){e.addClass(t,e.format(n.itemClassTemplate,{status:i,direction:s||"next",index:o+1}))})},animationEnd:function(t){this.sliding&&(e.hasClass(t.target,this.options.itemClass+"--show")||e.hasClass(t.target,this.options.itemClass+"--hide"))&&this.onEnd()},onRender:function(){this.runCallback("render")},onStart:function(){this.sliding=!0,this.runCallback("start")},onEnd:function(){this.sliding=!1,this.runCallback("end")},calculateValues:function(){this.itemCount=this.items.length,this.visibleCount=this.getVisibleCount(),this.visibleItems=e.$(e.format(".{0}--show",this.options.itemClass)),0===this.visibleItems.length&&(this.visibleItems=this.items.slice(0,this.visibleCount),this.show(this.visibleItems,"next")),this.pageCount=Math.ceil(this.itemCount/this.visibleCount),this.firstVisibleIndex=parseInt(this.visibleItems[0].getAttribute("data-rider-index")),this.currentPage=Math.ceil(this.firstVisibleIndex/this.visibleCount)+1,this.visibleItems.length!==this.visibleCount&&(this.visibleItems=this.items.slice(this.firstVisibleIndex,this.visibleCount),this.reset(),this.show(this.visibleItems,"next"))},getNextItemsForDirection:function(t,e){if(this.calculateValues(),1===this.pageCount)return this.$item;var i,s="prev"==t?-1:1;e=!!e&&parseInt(e);var n=e?("next"==t?e-2:e)*this.visibleCount:this.firstVisibleIndex,o=n+s*this.visibleCount;return e=e?e-s:this.currentPage,"prev"===t&&e===this.pageCount&&(o=this.visibleCount*(e-2)),i=this.items.slice(o,o+this.visibleCount),("next"===t&&e===this.pageCount||"prev"===t&&2===e)&&(i=this.items.slice(0,this.visibleCount)),("next"===t&&e===this.pageCount-1||"prev"===t&&1===e)&&(i=this.items.slice(-this.visibleCount)),i},getVisibleCount:function(){return e.isFunction(this.options.visibleCount)?this.options.visibleCount.call(this):parseInt(this.options.visibleCount)},slide:function(t){if(!this.sliding){this.onStart(),this.calculateValues();var i,s,n;"next"===t||"prev"===t?(n=t,s=this.getNextItemsForDirection(t)):(n=t>this.currentPage?"next":"prev",s=this.getNextItemsForDirection(n,t)),i=e.arrayDiff(this.visibleItems,s),this.render(i,s,n)}},next:function(){return this.slide("next")},prev:function(){return this.slide("prev")}},"function"==typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:t.Rider=e}(this);